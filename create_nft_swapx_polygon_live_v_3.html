<html>
<head>

<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="https://cdn.rawgit.com/ethereumjs/browser-builds/master/dist/ethereumjs-tx/ethereumjs-tx-1.3.3.js"></script>
<!-- Moralis SDK code -->
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="https://unpkg.com/moralis-v1@latest/dist/moralis.js"></script>
</script> 
  

<STYLE TYPE="text/css">


label {
margin-left: 0.5em;
cursor: pointer;
}




div {
padding: 10px;
border-radius: 25px;
border: 2px solid #5F6C6D;
background-color: #ffdab9;


}






input {

font-size: small;
color:#5F6C6D;
border: 2px solid #5F6C6D;

}

newDiv {

margin: 10px;
color:#5F6C6D; 
font-family: helvetica narrow;

}

center {

padding: 10px;
border-radius: 25px;
color:grey; 
font-family: helvetica narrow; 
font-size: large;
}




</style>
</head>


<body>
<center><img id="logo" src=barterNFT_logo_1155.png></img></center>

<button style="color:#5F6C6D; font-family: helvetica narrow, sans-serif;font-size: 40px;  position:absolute; border: 15px solid orange; top:0.5; right:0;" onclick="open_window()">offer trade</button>
<input type="file" name="fileInput" id="fileInput"><br><br>
<input type="text" name="file_name" id="file_name"><br><br>
<button onclick="submit_file()">file upload</button>
<center><p id="contract_address_ID"></p></center>

	
</body>







<script>
//https://unpkg.com/moralis/dist/moralis.js
//https://unpkg.com/moralis-v1@latest/dist/moralis.js
	  const serverUrl = "https://jgvwtbhpz221.usemoralis.com:2053/server";
      const appId = "jWYZTSxykRh5PsXRtoXPWu3coM5QDQAWJCwvXR51";
      Moralis.start({ serverUrl, appId });
//<button style="color:#5F6C6D; font-family: helvetica narrow, sans-serif;font-size: x-large;  position:absolute; top:0; right:25;" onClick="connect_metamask()">
          //Connect
        //</Button>
//<meta http-equiv="Content-Type" content="text/plain"; Charset=UTF-8">
//<div id="root"></div>
function open_window() {
  var myWindow = window.open("create_nft_swap_form_polygonx_live_v4.html", "offer trade");
}             



var metamask = (async function(){
  	
  await ethereum.enable();
  	
  
  //alert(balance)

})()

//sleep(200);
function connect(){
    provider.request({ method: "eth_requestAccounts" })
         
  };
web3 = new Web3(web3.currentProvider);    


    

//var web3 = new Web3(new Web3.providers.HttpProvider(
    //"https://mainnet.infura.io/v3/69462286c61f42d2891a2ced35c91f8d"
//));


//web3.eth.net.getNetworkType().then(console.log);


 //$(document).ready(function(){
 

Moralis.Web3.authenticate().then(function (user){
		console.log('logged in');
 })
 

var my_nft =(async function(){

var net = await web3.eth.net.getNetworkType()
var chain = await web3.eth.net.getId()
//alert(chain)
if(chain!=137)
//if(str(net).indexOf("Polygon") > -1) 
{alert("Please connect to the Polygon Network to use this dApp")};
})()
//return val
	
//}

web3.eth.net.isListening()
   .then(() => console.log('web3 is connected'))
   .catch(e => console.log('Wow. Something went wrong'));



var abi = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "approved",
				"type": "bool"
			}
		],
		"name": "ApprovalForAll",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256[]",
				"name": "ids",
				"type": "uint256[]"
			},
			{
				"indexed": false,
				"internalType": "uint256[]",
				"name": "values",
				"type": "uint256[]"
			}
		],
		"name": "TransferBatch",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "TransferSingle",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "string",
				"name": "value",
				"type": "string"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			}
		],
		"name": "URI",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "Address_listCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "CANNOT_TRANSFER_TO_ZERO_ADDRESS",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "NOT_CURRENT_OWNER",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "num",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "_offeror",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			}
		],
		"name": "accept_trade",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "account_list",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "contract IERC1155",
				"name": "_nftAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_num",
				"type": "uint256"
			}
		],
		"name": "add_to_accept",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "contract IERC1155",
				"name": "_nftAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId1",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_num",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			}
		],
		"name": "add_to_offer",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "address_list",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "accounts",
				"type": "address[]"
			},
			{
				"internalType": "uint256[]",
				"name": "ids",
				"type": "uint256[]"
			}
		],
		"name": "balanceOfBatch",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "debt_obligation_listx",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "fee",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			}
		],
		"name": "isApprovedForAll",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "last",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "contract IERC1155",
				"name": "_nftAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId1",
				"type": "uint256"
			},
			{
				"internalType": "contract IERC1155",
				"name": "_address",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId2",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_num",
				"type": "uint256"
			}
		],
		"name": "offer_trade",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			},
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			},
			{
				"internalType": "bytes",
				"name": "",
				"type": "bytes"
			}
		],
		"name": "onERC1155BatchReceived",
		"outputs": [
			{
				"internalType": "bytes4",
				"name": "",
				"type": "bytes4"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "bytes",
				"name": "",
				"type": "bytes"
			}
		],
		"name": "onERC1155Received",
		"outputs": [
			{
				"internalType": "bytes4",
				"name": "",
				"type": "bytes4"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256[]",
				"name": "ids",
				"type": "uint256[]"
			},
			{
				"internalType": "uint256[]",
				"name": "amounts",
				"type": "uint256[]"
			},
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "safeBatchTransferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "safeTransferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "approved",
				"type": "bool"
			}
		],
		"name": "setApprovalForAll",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_fee",
				"type": "uint256"
			}
		],
		"name": "setfee",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes4",
				"name": "interfaceId",
				"type": "bytes4"
			}
		],
		"name": "supportsInterface",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "term_list",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "token_contracts_list1xy",
		"outputs": [
			{
				"internalType": "contract IERC1155",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "num",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "_offeror",
				"type": "address"
			}
		],
		"name": "token_contracts_list1xyCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "token_contracts_list2xy",
		"outputs": [
			{
				"internalType": "contract IERC1155",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "num",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "_offeror",
				"type": "address"
			}
		],
		"name": "token_contracts_list2xyCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "tokens_list1xy",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "tokens_list2xy",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "transferto",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "uri",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "num",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			}
		],
		"name": "withdraw_nft",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	}
]

	//localStorage.setItem("NFT Contract", document.getElementById("NFT_contract").value);
	//localStorage.setItem("NFT Token ID", document.getElementById("NFT_Token_ID").value);
	//localStorage.setItem("Loan Amount", document.getElementById("loan_amount").value);
	//localStorage.setItem("Loan Term", document.getElementById("loan_term").value);
	
	



const contract_address = web3.utils.toChecksumAddress("0x9b59104537128a583df67c5fa13e922ce3fec147")

const contract_bal = new web3.eth.Contract(abi, contract_address);




const file_input = document.getElementById("fileInput");


function submit_file(){
var display = (async function(){

var fname = document.getElementById("file_name").innerHTML;
var f_name = fname.trim();
console.log(fname)

// Save file input to IPFS
const data = file_input.files[0];
const file = new Moralis.File(data.name, data);
await file.saveIPFS();

//console.log(file.ipfs(), file.hash())

// Save file reference to Moralis
const jobApplication = new Moralis.Object("Applications");
jobApplication.set("name", f_name);
jobApplication.set("resume", file);
await jobApplication.save();

// Retrieve file
const query = new Moralis.Query("Applications");
query.equalTo("name", f_name);
query.find().then(function ([application]) {
  const ipfs = application.get("resume").ipfs();
  const hash = application.get("resume").hash();
  console.log("IPFS url", ipfs);
  console.log("IPFS hash", hash);
});

return file.ipfs()

})()
}










 $(document).ready(function(){
//function display_loan_info(){
var display = (async function(){

<!-- const options = { -->
  <!-- abi: [ -->
    <!-- { -->
      <!-- path: "moralis/logo.jpg", -->
      <!-- content: -->
        <!-- "iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAApgAAAKYB3X3", -->
    <!-- }, -->
  <!-- ], -->
<!-- }; -->
<!-- const path = await Moralis.Web3API.storage.uploadFolder(options); -->









console.log(path);

  //localStorage.setItem("mySharedData", document.getElementById("password").value);
    
	
	//var pwdx = localStorage.getItem("mySharedData");

	
  	
	const addressCount = await contract_bal.methods.Address_listCount().call();
		
		
	
	//const contract_bal = new web3.eth.Contract(abi, contract_address);
	
	
	
	
	//address_count = addressCount
	
	var chat = document.getElementById("contract_address_ID");	// finds the container
	//var chat = document.getElementById("root");
	var documentFragment = document.createDocumentFragment();
	
	for (var i = addressCount; i>0; i--){
	var address = await contract_bal.methods.address_list(i-1).call();
	var address = web3.utils.toChecksumAddress(address)
	
	var container = document.createElement('div')
	container.id = "q" + i;
	documentFragment.appendChild(container);
	//var chat = document.createElement("box");
	
	var box1 = document.createElement('div')
	box1.id = "r" + i;
	var box2 = document.createElement('div')
	box2.id = "s" + i;
	var latest = await contract_bal.methods.debt_obligation_listx(i, address).call();
	//console.log("test completed " + latest)
	container.appendChild(box1);
	container.appendChild(box2);
	container.insertAdjacentHTML('afterbegin', '<p style="color:#5F6C6D; font-family: helvetica narrow, sans-serif;">  offer no: ' + i + '</p>')
	
	
	var contract_length = await contract_bal.methods.token_contracts_list1xyCount(i, address).call();
	for (j=0;j<contract_length;j++){
	var contract_ID1 = await contract_bal.methods.token_contracts_list1xy(i, address, j).call();
	var tokenID = await contract_bal.methods.tokens_list1xy(i, address, j).call();
	
	//var name = await new web3.eth.Contract(abi, contract_ID1).methods.name().call();
	
		//canvas_4(contract_ID1, tokenID, address, i, i, box2).catch(function(error){ canvas_3(contract_bal.methods.tokens_image1xy, i, address, j, 10, box1);})
		try{
		canvas_4(contract_ID1, tokenID, address, i, i, box1);
		}catch(err){ 
		canvas_5(contract_ID1, tokenID, address, i, i, box1);
		}
		<!-- try { -->
		<!-- //canvas_4(contract_ID1, tokenID, address, j, -10, box1); -->
		//canvas_4(contract_ID1, tokenID, address, i, i, box1).catch(function(error)){canvas_3(contract_bal.methods.tokens_image1xy, i, address, j, -10, box1); }
		
			<!-- }catch(err){ -->
		<!-- //canvas_4(contract_ID1, tokenID, address, j, -10, box1); -->
		<!-- canvas_3(contract_bal.methods.tokens_image1xy, i, address, j, -10, box1); -->
		<!-- //canvas_1(contract_ID2, tokenID2, box1); -->
	 <!-- } -->
		

	
	 <!-- } -->
	
	}
	
	
	
	var contract_length1 = await contract_bal.methods.token_contracts_list2xyCount(i, address).call();
	
	var array_contract_ID2 = new Array();
	var array_tokenID2 = new Array();
	box1.insertAdjacentHTML('afterend','<center style="color:#5F6C6D; font-family: helvetica narrow, sans-serif;"> &#8657; trade &#8659;</center>')
	
	for (j=0;j<contract_length1;j++){ 
	
	var contract_ID2 = await contract_bal.methods.token_contracts_list2xy(i, address, j).call();
	//console.log("array_contract: " + contract_ID2 + "no# " + i + ' ' + j)
	array_contract_ID2.push("'" + contract_ID2 + "'");
	
	
	//var name2 = await new web3.eth.Contract(abi, contract_ID2).methods.name().call();
	
	
	
	
	
	var tokenID2 = await contract_bal.methods.tokens_list2xy(i, address, j).call();
	//console.log("array_token: " + tokenID2)
	array_tokenID2.push(tokenID2);
	
	try{
	//canvas_4(contract_ID2, tokenID2, address, i, i, box2).catch(function(error){ canvas_3(contract_bal.methods.tokens_image2xy, i, address, j, 10, box2);}
	canvas_4(contract_ID2, tokenID2, address, i, i, box2);
	}catch(err){
	canvas_5(contract_ID2, tokenID2, address, i, i, box2);
	}
	//canvas_4(contract_ID2, tokenID2, address, i, i, box2);
	
	<!-- try { -->
	<!-- //canvas_4(contract_ID2, tokenID2, address, j, 10, box2); -->
	<!-- canvas_4(contract_ID2, tokenID2, address, i, i, box2).catch(function(error) { canvas_3(contract_bal.methods.tokens_image2xy, i, address, j, 10, box2);} -->
		
	 <!-- }catch(err){ -->
	 <!-- canvas_3(contract_bal.methods.tokens_image2xy, i, address, j, 10, box2); -->
	 
		<!-- //canvas_1(contract_ID2, tokenID2, box2); -->
	 <!-- } -->
		

	}
	
	var trade_bool = await contract_bal.methods.debt_obligation_listx(i, address).call();
	container.insertAdjacentHTML('beforeend', '<p style="color:#5F6C6D; font-family: helvetica narrow, sans-serif;">  barter accepted: ' + trade_bool + '</p>');
	container.insertAdjacentHTML('afterend', '<p>&nbsp;</p>');
	
	var _i = (i)
	var newBtn = document.createElement('input');
	newBtn.setAttribute('type', 'button');
	newBtn.value = "approve";
	//newBtn.setAttribute('onclick', 'to_approve(' + "'" + contract_ID2 + "'" + ","  + "'" + address + "'" + "," + tokenID2 + "," + _i + ')');
	newBtn.setAttribute('onclick', 'to_approve(' + "[" + array_contract_ID2 + "]" + ","  + "'" + address + "'" + ", [" + array_tokenID2 + "]," + _i + ')');
	var newBtn1 = document.createElement('input');
	newBtn1.setAttribute('type', 'button');
	newBtn1.value = "accept trade";
	newBtn1.setAttribute('onclick', 'make_trade(' + "[" + array_contract_ID2 + "]" + ","  + "'" + address + "'" + ", [" + array_tokenID2 + "]," + _i + ')');
	//console.log('make_trade(' + "'" + array_contract_ID2 + "'" + ","  + "'" + address + "'" + "," + array_tokenID2 + ')')
	newBtn.style = "color:grey; font-family: helvetica narrow, sans-serif;font-size: large;";
	
	newBtn.id = 'a' + i;
	newBtn1.id = 'a' + i;
	container.appendChild(newBtn);
	container.appendChild(newBtn1);
	//document.getElementById("r" & _i).appendChild(newBtn);
	
	
	
	
	//console.log(_image2);
	
	
	chat.appendChild(documentFragment);
	//document.getElementById('a' + i).innerHTML = "swap completed " + latest;
	
	<!-- var newDiv = document.createElement('div'); -->
	<!-- newDiv.id = 'w'+i; -->
	<!-- ewDiv.appendChild(newDiv); -->
	
	<!-- document.getElementById("w" + i).innerHTML = "swap completed: " + latest; -->
	//document.getElementById("latest_block").innerHTML = latest;
	//console.log(latest)
	
	
	//}
	}
	
	
	
	
	
	
	
	
	
	
	
	




	function canvas_4 (k, num1, addr, num2, n, bx){
var acct = (async function(){
//var _image = await k(num1, addr, num2).call();
//const imgurl = _image //"https://gateway.pinata.cloud/ipfs/QmTLwrSf7fk8jzFRgVZ2r11pzMZQ87nAHYqDBzHEtrZiF5/10.jpg"
	var contract_address = web3.utils.toChecksumAddress(k);
	var contract_bal = await new web3.eth.Contract(abi, contract_address);
    var lnk = await contract_bal.methods.uri(num1).call();
	//var supply = await contract_bal.methods.balanceOf(["0xDF154B220FfC5980A9f136C852Ed47bb12ed3Aca"], ["210"]).call();
	//console.log(supply);
  <!-- if (lnk.substring(0,4) == "ipfs"){ -->
	<!-- lnk = 'https://ipfs.io/ipfs/' + lnk.slice(7) -->
	<!-- } -->
	var lnk1 = lnk.replace('{id}', num1);
	const params = { 'theUrl': lnk1 };
	console.log(lnk1);
	const metadata = await Moralis.Cloud.run("fetchJSON", params);

	<!-- const str = JSON.stringify(metadata.data.image); -->
	<!-- const bytes = new TextEncoder().encode(str); -->
	<!-- const blob = new Blob([bytes], { -->
		<!-- type: "application/json;charset=utf-8" -->
	<!-- }); -->
	
	
	var image_ = metadata.data.image
	if (image_.substring(0,4) == "ipfs"){
	image_ = 'https://ipfs.io/ipfs/' + image_.slice(7)
	}
	console.log("metadata_image" + image_)
  //var urlCreator = window.URL || window.webkitURL;
   //var imageUrl = urlCreator.createObjectURL(image_);
   //const myImgElem = document.getElementById('my-img');
   //var myImgElem = new Image;
   
   //myImgElem.src = imageUrl;
   var img = new Image();
	//img.crossOrigin="anonymous"
	img.src = image_ //imageUrl
	//img.crossOrigin="anonymous";
	//img.setAttribute('crossOrigin', '*');
	//ew1Div.addEventListener("load", getCanvas);
	img.onload = function (){
	
		//var canvas = document.getElementById("myCanvas");
		var canvas = document.createElement('canvas');
		canvas.id = "b" + n;
        var ctx = canvas.getContext('2d');
		var width = img.width;
		var height = img.height;

 if (width > height) {
    if (width > 75 ){
      //height *= max_width / width;
      height = Math.round(height *= 75 / width);
      width = 75;
    }
  } else {
    if (height > 75) {
      //width *= max_height / height;
      width = Math.round(width *= 75 / height);
      height = 75;
    }
  }
  
  // resize the canvas and draw the image data into it
  canvas.width = width;
  canvas.height = height;
  var ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0, width, height);

        ctx.drawImage(img, 0, 0, width, height);
		bx.insertBefore(canvas, bx.children[0]);
		//container.id = "cc" & i;
		return canvas.toDataURL("image/*",0.2);
		
			
			}
	
		
   //ew1Div.appendChild(canvas1);
  

})()		
	
}
	


	function canvas_5 (k, num1, addr, num2, n, bx){
var acct = (async function(){
//var _image = await k(num1, addr, num2).call();
//const imgurl = _image //"https://gateway.pinata.cloud/ipfs/QmTLwrSf7fk8jzFRgVZ2r11pzMZQ87nAHYqDBzHEtrZiF5/10.jpg"
	var contract_address = web3.utils.toChecksumAddress(k);
	var contract_bal = await new web3.eth.Contract(abi, contract_address);
    var lnk = await contract_bal.methods.tokenURI(num1).call();
  
  if (lnk.substring(0,4) == "ipfs"){
	lnk = 'https://ipfs.io/ipfs/' + lnk.slice(7)
	}
	
	const params = { 'theUrl': lnk };
	const metadata = await Moralis.Cloud.run("fetchJSON", params);

	<!-- const str = JSON.stringify(metadata.data.image); -->
	<!-- const bytes = new TextEncoder().encode(str); -->
	<!-- const blob = new Blob([bytes], { -->
		<!-- type: "application/json;charset=utf-8" -->
	<!-- }); -->
	
	
	var image_ = metadata.data.image
	if (image_.substring(0,4) == "ipfs"){
	image_ = 'https://ipfs.io/ipfs/' + image_.slice(7)
	}
	//console.log("metadata_image" + image_)
  //var urlCreator = window.URL || window.webkitURL;
   //var imageUrl = urlCreator.createObjectURL(image_);
   //const myImgElem = document.getElementById('my-img');
   //var myImgElem = new Image;
   
   //myImgElem.src = imageUrl;
   var img = new Image();
	//img.crossOrigin="anonymous"
	img.src = image_ //imageUrl
	//img.crossOrigin="anonymous";
	//ew1Div.addEventListener("load", getCanvas);
	img.onload = function (){
	
		//var canvas = document.getElementById("myCanvas");
		var canvas = document.createElement('canvas');
		canvas.id = "b" + n;
        var ctx = canvas.getContext('2d');
		var width = img.width;
		var height = img.height;

 if (width > height) {
    if (width > 75 ){
      //height *= max_width / width;
      height = Math.round(height *= 75 / width);
      width = 75;
    }
  } else {
    if (height > 75) {
      //width *= max_height / height;
      width = Math.round(width *= 75 / height);
      height = 75;
    }
  }
  
  // resize the canvas and draw the image data into it
  canvas.width = width;
  canvas.height = height;
  var ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0, width, height);

        ctx.drawImage(img, 0, 0, width, height);
		bx.insertBefore(canvas, bx.children[0]);
		//container.id = "cc" & i;
		return canvas.toDataURL("image/*",0.2);
		
			
			}
	
		
   //ew1Div.appendChild(canvas1);
  

})()		
	
}	
	//document.getElementById("thetable").appendChild(toAdd);



})()

        });


function isError(obj){
    return Object.prototype.toString.call(obj) === "[object Error]";
}

	





function make_trade(add1x, add2x, tokenID, n){

	var nft = add1x[0];
	var address = add2x
	var nft_id = tokenID[0];
	var num = n
	
	//to_approve(nft, nft_id)
var acct = (async function(){
  	
  //var result = await getAccounts()
	await window.ethereum.enable();
	
		var accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        var account = accounts[0];
		//console.log("account " + account);
		//console.log("nft address " + nft);
		//console.log("nft id " + nft_id);
		const contract_address1 = web3.utils.toChecksumAddress(nft);
		
		
		//var contract_bal = await new web3.eth.Contract(abi, nft).methods.balanceOf(account, nft_id).call();
		var supply = await new web3.eth.Contract(abi, contract_address1).methods.balanceOf(account, nft_id).call();
		//var supply = await contract_bal.methods.balanceOf(account, nft_id).call();
		
		//console.log(supply);
        var _data = new web3.eth.Contract(abi, contract_address).methods.accept_trade(num, address, supply).encodeABI();
        
	var result = await web3.eth.getTransactionCount(account)
	_nonce = result
        //console.log(account)
		
	await web3.eth.sendTransaction({'gas': web3.utils.toHex(500000),'gasPrice': web3.utils.toHex(web3.utils.toWei('100', 'gwei')), 'from': account, 'to': contract_address, 'nonce': web3.utils.toHex(_nonce),'data': _data})
         

})()
}

	
	
	













//client_account = accounts[0]; // assuming master client addr



function to_approve(k, add, k_id, num){
var acct = (async function(){
  	
  //var result = await getAccounts()
	await window.ethereum.enable();
	
	for (var i = 0; i<k.length; i++){
	var nft_k = k[i]
	//var nft_id = localStorage.getItem("NFT Token ID");
	var add1 = add
	var nft_id = k_id[i]
	var n = num
	var loan_amt = localStorage.getItem("Loan Amount");
	var loan_term = localStorage.getItem("Loan Term");
	
	var add1x = localStorage.getItem("mySharedData");
	var add2x = localStorage.getItem("mySharedData2");
	var token_nx = localStorage.getItem("mySharedData1");
	
 	var contract_address1 = web3.utils.toChecksumAddress(nft_k)
        var _data = new web3.eth.Contract(abi, contract_address).methods.setApprovalForAll("0x9b59104537128a583df67c5fa13e922ce3fec147", true).encodeABI();
        var accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        var account = accounts[0];
	var result = await web3.eth.getTransactionCount(account)
	_nonce = result
        //console.log(account)
		
	await web3.eth.sendTransaction({'gas': web3.utils.toHex(100000),'gasPrice': web3.utils.toHex(web3.utils.toWei('100', 'gwei')), 'from': account, 'to': contract_address1, 'nonce': web3.utils.toHex(_nonce),'data': _data})
         //window.ethereum.on('accountsChanged', function (accounts) {
            // Time to reload your interface with accounts[0]!
            //console.log(accounts[0])
           	
  //console.log('Woo done!', result[0])
  //balance = result
  //alert(balance)
  }
	make_trade(nft_k, add1, nft_id, n)
})()

}

function getNFT(){
var my_nft =(async function(){
var contract_address = await web3.utils.toChecksumAddress("0xd4ba547282a909afc9b4c58c9f4777a34a8582eb")

var contract_bal = await new web3.eth.Contract(abi, contract_address);
var totalSupply = await contract_bal.methods.baseURI().call();
alert(totalSupply)
})()
//return val
	}





<!-- function getName(k){ -->
<!-- //q = $('input[name=drone]:checked').val();	 -->
	<!-- //alert(bal) -->
	
<!-- var val = (async function(){ -->
  <!-- var contract_address = await web3.utils.toChecksumAddress(k) -->
  <!-- var contract_bal = await new web3.eth.Contract(abi, contract_address); -->
  <!-- var bal = await contract_bal.methods.name.call(); -->
  <!-- //alert(bal); -->
  <!-- var result = await getName() -->
  <!-- //console.log('Woo done!', bal) -->
 
	

<!-- })() -->
<!-- //return val -->
	<!-- } -->
















          
    </script>
	
</body>
</html>