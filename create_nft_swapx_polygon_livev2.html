
<html>
<head>

<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="https://cdn.rawgit.com/ethereumjs/browser-builds/master/dist/ethereumjs-tx/ethereumjs-tx-1.3.3.js"></script>
<!-- Moralis SDK code -->
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="https://unpkg.com/moralis/dist/moralis.js"></script>
</script> 
  

<STYLE TYPE="text/css">


label {
margin-left: 0.5em;
cursor: pointer;
}




div {
padding: 10px;
border-radius: 25px;
border: 2px solid #5F6C6D;
background-color: powderblue;


}






input {

font-size: small;
color:#5F6C6D;
border: 2px solid #5F6C6D;

}

newDiv {

margin: 10px;
color:#5F6C6D; 
font-family: helvetica narrow;

}

center {

color:grey; 
font-family: helvetica narrow; 
font-size: large;
}




</style>
</head>


<body>
<center><img id="logo" src=barterNFT_logo.png></img></center>

<button style="color:#5F6C6D; font-family: helvetica narrow, sans-serif;font-size: x-large;  position:absolute; top:0; right:0;" onclick="open_window()">offer trade</button>
<center><p id="contract_address_ID"></p></center>

	
</body>







<script>

	  const serverUrl = "https://jgvwtbhpz221.usemoralis.com:2053/server";
      const appId = "jWYZTSxykRh5PsXRtoXPWu3coM5QDQAWJCwvXR51";
      Moralis.start({ serverUrl, appId });
//<button style="color:#5F6C6D; font-family: helvetica narrow, sans-serif;font-size: x-large;  position:absolute; top:0; right:25;" onClick="connect_metamask()">
          //Connect
        //</Button>
//<meta http-equiv="Content-Type" content="text/plain"; Charset=UTF-8">
//<div id="root"></div>
function open_window() {
  var myWindow = window.open("create_nft_swap_form_polygonx_livev4.html", "offer trade");
}             



var metamask = (async function(){
  	
  await ethereum.enable();
  	
  
  //alert(balance)

})()

//sleep(200);
function connect(){
    provider.request({ method: "eth_requestAccounts" })
         
  };
web3 = new Web3(web3.currentProvider);        

//var web3 = new Web3(new Web3.providers.HttpProvider(
    //"https://mainnet.infura.io/v3/69462286c61f42d2891a2ced35c91f8d"
//));


web3.eth.net.getNetworkType()
.then(console.log);

web3.eth.net.isListening()
   .then(() => console.log('web3 is connected'))
   .catch(e => console.log('Wow. Something went wrong'));



var abi = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "_owner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "_approved",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "Approval",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "_owner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "_operator",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "_approved",
				"type": "bool"
			}
		],
		"name": "ApprovalForAll",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "_from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "Address_listCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "CANNOT_TRANSFER_TO_ZERO_ADDRESS",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "NOT_CURRENT_OWNER",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "num",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "_offeror",
				"type": "address"
			}
		],
		"name": "accept_trade",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "account_list",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "contract ERC721",
				"name": "_nftAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_num",
				"type": "uint256"
			}
		],
		"name": "add_to_accept",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "contract ERC721",
				"name": "_nftAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId1",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_num",
				"type": "uint256"
			}
		],
		"name": "add_to_offer",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "address_list",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_approved",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "approve",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_owner",
				"type": "address"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "debt_obligation_listx",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "fee",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "getApproved",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_owner",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_operator",
				"type": "address"
			}
		],
		"name": "isApprovedForAll",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "last",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "name",
		"outputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "contract ERC721",
				"name": "_nftAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId1",
				"type": "uint256"
			},
			{
				"internalType": "contract ERC721",
				"name": "_address",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId2",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_num",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_image1",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_image2",
				"type": "string"
			}
		],
		"name": "offer_trade",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			},
			{
				"internalType": "bytes",
				"name": "",
				"type": "bytes"
			}
		],
		"name": "onERC721Received",
		"outputs": [
			{
				"internalType": "bytes4",
				"name": "",
				"type": "bytes4"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "ownerOf",
		"outputs": [
			{
				"internalType": "address",
				"name": "_owner",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "safeTransferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			},
			{
				"internalType": "bytes",
				"name": "_data",
				"type": "bytes"
			}
		],
		"name": "safeTransferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_operator",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "_approved",
				"type": "bool"
			}
		],
		"name": "setApprovalForAll",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_fee",
				"type": "uint256"
			}
		],
		"name": "setfee",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes4",
				"name": "_interfaceID",
				"type": "bytes4"
			}
		],
		"name": "supportsInterface",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "symbol",
		"outputs": [
			{
				"internalType": "string",
				"name": "_symbol",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "term_list",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "tokenURI",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "token_contracts_list1xy",
		"outputs": [
			{
				"internalType": "contract ERC721",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "num",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "_offeror",
				"type": "address"
			}
		],
		"name": "token_contracts_list1xyCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "token_contracts_list2xy",
		"outputs": [
			{
				"internalType": "contract ERC721",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "num",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "_offeror",
				"type": "address"
			}
		],
		"name": "token_contracts_list2xyCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "tokens_image1xy",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "tokens_image2xy",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "tokens_list1xy",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "tokens_list2xy",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "transferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "transferto",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "num",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			}
		],
		"name": "withdraw_nft",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	}
]

	//localStorage.setItem("NFT Contract", document.getElementById("NFT_contract").value);
	//localStorage.setItem("NFT Token ID", document.getElementById("NFT_Token_ID").value);
	//localStorage.setItem("Loan Amount", document.getElementById("loan_amount").value);
	//localStorage.setItem("Loan Term", document.getElementById("loan_term").value);

const contract_address = web3.utils.toChecksumAddress("0xd4ba547282a909afc9b4c58c9f4777a34a8582eb")

const contract_bal = new web3.eth.Contract(abi, contract_address);

















 $(document).ready(function(){
//function display_loan_info(){
var display = (async function(){
  
  
  //localStorage.setItem("mySharedData", document.getElementById("password").value);
    
	
	//var pwdx = localStorage.getItem("mySharedData");

	
  	
	const addressCount = await contract_bal.methods.Address_listCount().call();
		
		
	
	//const contract_bal = new web3.eth.Contract(abi, contract_address);
	
	
	
	
	//address_count = addressCount
	
	var chat = document.getElementById("contract_address_ID");	// finds the container
	//var chat = document.getElementById("root");
	var documentFragment = document.createDocumentFragment();
	
	for (var i = addressCount; i>0; i--){
	var address = await contract_bal.methods.address_list(i-1).call();
	var address = web3.utils.toChecksumAddress(address)
	
	var container = document.createElement('div')
	container.id = "q" + i;
	documentFragment.appendChild(container);
	//var chat = document.createElement("box");
	
	var box1 = document.createElement('div')
	box1.id = "r" + i;
	var box2 = document.createElement('div')
	box2.id = "s" + i;
	var latest = await contract_bal.methods.debt_obligation_listx(i, address).call();
	console.log("test completed " + latest)
	container.appendChild(box1);
	container.appendChild(box2);
	container.insertAdjacentHTML('afterbegin', '<p style="color:#5F6C6D; font-family: helvetica narrow, sans-serif;">  offer no: ' + i + '</p>')
	
	
	var contract_length = await contract_bal.methods.token_contracts_list1xyCount(i, address).call();
	for (j=0;j<contract_length;j++){
	var contract_ID1 = await contract_bal.methods.token_contracts_list1xy(i, address, j).call();
	var tokenID = await contract_bal.methods.tokens_list1xy(i, address, j).call();
	
	var name = await new web3.eth.Contract(abi, contract_ID1).methods.name().call();
	
		
		canvas_4(contract_ID1, tokenID, address, i, i, box1);
		
		<!-- try { -->
		<!-- //canvas_4(contract_ID1, tokenID, address, j, -10, box1); -->
		<!-- canvas_4(contract_ID1, tokenID, address, i, i, box1).catch(function(error)){canvas_3(contract_bal.methods.tokens_image1xy, i, address, j, -10, box1); } -->
		
			<!-- }catch(err){ -->
		<!-- //canvas_4(contract_ID1, tokenID, address, j, -10, box1); -->
		<!-- canvas_3(contract_bal.methods.tokens_image1xy, i, address, j, -10, box1); -->
		<!-- //canvas_1(contract_ID2, tokenID2, box1); -->
	 <!-- } -->
		

	
	 <!-- } -->
	
	
	
	
	
	var contract_length1 = await contract_bal.methods.token_contracts_list2xyCount(i, address).call();
	
	var array_contract_ID2 = new Array();
	var array_tokenID2 = new Array();
	box1.insertAdjacentHTML('afterend','<center style="color:#5F6C6D; font-family: helvetica narrow, sans-serif;"> &#8657; trade &#8659;</center>')
	
	for (j=0;j<contract_length1;j++){ 
	
	var contract_ID2 = await contract_bal.methods.token_contracts_list2xy(i, address, j).call();
	//console.log("array_contract: " + contract_ID2 + "no# " + i + ' ' + j)
	array_contract_ID2.push("'" + contract_ID2 + "'");
	
	
	var name2 = await new web3.eth.Contract(abi, contract_ID2).methods.name().call();
	
	
	
	
	
	var tokenID2 = await contract_bal.methods.tokens_list2xy(i, address, j).call();
	//console.log("array_token: " + tokenID2)
	array_tokenID2.push(tokenID2);
	
	//canvas_4(contract_ID2, tokenID2, address, i, i, box2).catch(function(error){ canvas_3(contract_bal.methods.tokens_image2xy, i, address, j, 10, box2);})
	
	canvas_4(contract_ID2, tokenID2, address, i, i, box2);
	
	<!-- try { -->
	<!-- //canvas_4(contract_ID2, tokenID2, address, j, 10, box2); -->
	<!-- canvas_4(contract_ID2, tokenID2, address, i, i, box2).catch(function(error) { canvas_3(contract_bal.methods.tokens_image2xy, i, address, j, 10, box2);} -->
		
	 <!-- }catch(err){ -->
	 <!-- canvas_3(contract_bal.methods.tokens_image2xy, i, address, j, 10, box2); -->
	 
		<!-- //canvas_1(contract_ID2, tokenID2, box2); -->
	 <!-- } -->
		

	}
	
	var trade_bool = await contract_bal.methods.debt_obligation_listx(i, address).call();
	container.insertAdjacentHTML('beforeend', '<p style="color:#5F6C6D; font-family: helvetica narrow, sans-serif;">  barter accepted: ' + trade_bool + '</p>')
	
	var _i = (i)
	var newBtn = document.createElement('input');
	newBtn.setAttribute('type', 'button');
	newBtn.value = "accept trade";
	//newBtn.setAttribute('onclick', 'to_approve(' + "'" + contract_ID2 + "'" + ","  + "'" + address + "'" + "," + tokenID2 + "," + _i + ')');
	newBtn.setAttribute('onclick', 'to_approve(' + "[" + array_contract_ID2 + "]" + ","  + "'" + address + "'" + ", [" + array_tokenID2 + "]," + _i + ')');
	//console.log('make_trade(' + "'" + array_contract_ID2 + "'" + ","  + "'" + address + "'" + "," + array_tokenID2 + ')')
	newBtn.style = "color:grey; font-family: helvetica narrow, sans-serif;font-size: large;";
	
	newBtn.id = 'a' + i;
	
	container.appendChild(newBtn);
	//document.getElementById("r" & _i).appendChild(newBtn);
	
	
	
	
	//console.log(_image2);
	
	
	chat.appendChild(documentFragment);
	//document.getElementById('a' + i).innerHTML = "swap completed " + latest;
	
	<!-- var newDiv = document.createElement('div'); -->
	<!-- newDiv.id = 'w'+i; -->
	<!-- ewDiv.appendChild(newDiv); -->
	
	<!-- document.getElementById("w" + i).innerHTML = "swap completed: " + latest; -->
	//document.getElementById("latest_block").innerHTML = latest;
	//console.log(latest)
	
	
	}
	}
	
	function canvas_1(contract_ID1, tokenID, bx){
	var acct = (async function(){
	const image = await image_and_name(contract_ID1, tokenID, getImage);
	//console.log(image);
	var newDiv = document.createElement('img');
	newDiv.id = 'rs'+i;
	//newDiv.setAttribute('width', '15%');
	//newDiv.setAttribute('height', '15%');
	//newDiv.loading = "lazy";
	//newDiv.onload = await "(image_and_name(" + contract_ID1 + ", " + tokenID + ", getImage))"
	//newDiv.addEventListener("load", "(image_and_name(" + contract_ID1 + ", " + tokenID + ", getImage))");
	//chat.appendChild(newDiv);
	function getImage(xhttp){
			var result = xhttp.response;
			JSONresult = JSON.parse(result);
			console.log(JSONresult.image);
			//var result1 = JSONresult.image
			//return result1
	
			var img = new Image();
            img.src = JSONresult.image
			img.id = "rs" & i
			//img.style.width = '15%'
			//img.style.height = '15%'
			//img.setAttribute('width', '15%');
			//img.setAttribute('height', '15%');
			
            bx.appendChild(img);
			
	//document.getElementById("rs" + i).loading = "lazy";
	//document.getElementById("rs" + i).src = JSONresult.image;
	//document.getElementById("rs" + i).setAttribute('width', '15%');
	//document.getElementById("rs" + i).setAttribute('height', '15%');
	}
	})()
	}
	
	
	
	
	
	
	
	
	
	
	function canvas_2(k, num1, addr, num2, n, bx){
	var acct = (async function(){
	var _image = await k(num1, addr, num2).call();
		var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
	  //this.open("get", _image, true);
      //this.setRequestHeader('Access-Control-Allow-Origin', '*')
	  //var response = this.blob;
	  //var urlCreator = this.blob; 
	  //var blobObj = new Blob([atob(this.blob)], { type: "image/jpeg" });
  var urlCreator = window.URL || window.webkitURL;
   var imageUrl = urlCreator.createObjectURL(this);
   //const myImgElem = document.getElementById('my-img');
   //var myImgElem = new Image;
   
   //myImgElem.src = imageUrl;
   var img = new Image();
  
	img.src = imageUrl
	//ew1Div.addEventListener("load", getCanvas);
	img.onload = function (){
	
		//var canvas = document.getElementById("myCanvas");
		var canvas = document.createElement('canvas');
		canvas.id = "b" + num1;
        var ctx = canvas.getContext('2d');
		var width = img.width;
		var height = img.height;

 if (width > height) {
    if (width > 75 ){
      //height *= max_width / width;
      height = Math.round(height *= 75 / width);
      width = 75 + n;
    }
  } else {
    if (height > 75) {
      //width *= max_height / height;
      width = Math.round(width *= 75 / height);
      height = 75 + n;
    }
  }
  
  // resize the canvas and draw the image data into it
  canvas.width = width;
  canvas.height = height;
  var ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0, width, height);

        ctx.drawImage(img, 0, 0, width, height);
		bx.insertBefore(canvas, bx.children[0]);
		//container.id = "cc" & i;
		return canvas.toDataURL("image/jpeg",0.2);
		
			
			}
	
		
   //ew1Div.appendChild(canvas1);
    }
  };
  xhttp.open("GET", _image, true);
  xhttp.setRequestHeader('Access-Control-Allow-Origin', '*');
  xhttp.setRequestHeader('Access-Control-Allow-Headers', '*');
  xhttp.setRequestHeader('Content-type', 'image/jpeg');
  xhttp.responseType = 'blob'
  xhttp.send();
	
})()
}
	function canvas_3 (k, num1, addr, num2, n, bx){
var acct = (async function(){
var _image = await k(num1, addr, num2).call();

if (_image.substring(0,4) == "ipfs"){
	_image = 'https://ipfs.io/ipfs/' + lnk.slice(7)
	}
const imgurl = _image //"https://gateway.pinata.cloud/ipfs/QmTLwrSf7fk8jzFRgVZ2r11pzMZQ87nAHYqDBzHEtrZiF5/10.jpg"
fetch(imgurl, {'Access-Control-Allow-Origin': "*",
'Access-Control-Allow-Headers': "*"
}).then(response => response.blob())
  .then(myBlob => {
  var urlCreator = window.URL || window.webkitURL;
   var imageUrl = urlCreator.createObjectURL(myBlob);
   //const myImgElem = document.getElementById('my-img');
   //var myImgElem = new Image;
   
   //myImgElem.src = imageUrl;
   var img = new Image();
  
	img.src = imageUrl
	//ew1Div.addEventListener("load", getCanvas);
	img.onload = function (){
	
		//var canvas = document.getElementById("myCanvas");
		var canvas = document.createElement('canvas');
		canvas.id = "b" + num1;
        var ctx = canvas.getContext('2d');
		var width = img.width;
		var height = img.height;

 if (width > height) {
    if (width > 75 ){
      //height *= max_width / width;
      height = Math.round(height *= 75 / width);
      width = 75 + n;
    }
  } else {
    if (height > 75) {
      //width *= max_height / height;
      width = Math.round(width *= 75 / height);
      height = 75 + n;
    }
  }
  
  // resize the canvas and draw the image data into it
  canvas.width = width;
  canvas.height = height;
  var ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0, width, height);

        ctx.drawImage(img, 0, 0, width, height);
		bx.insertBefore(canvas, bx.children[0]);
		//container.id = "cc" & i;
		return canvas.toDataURL("image/jpeg",0.2);
		
			
			}
	
		
   //ew1Div.appendChild(canvas1);
  
})
})()		
	
}


	function canvas_4 (k, num1, addr, num2, n, bx){
var acct = (async function(){
//var _image = await k(num1, addr, num2).call();
//const imgurl = _image //"https://gateway.pinata.cloud/ipfs/QmTLwrSf7fk8jzFRgVZ2r11pzMZQ87nAHYqDBzHEtrZiF5/10.jpg"
	var contract_address = web3.utils.toChecksumAddress(k);
	var contract_bal = await new web3.eth.Contract(abi, contract_address);
    var lnk = await contract_bal.methods.tokenURI(num1).call();
  
  if (lnk.substring(0,4) == "ipfs"){
	lnk = 'https://ipfs.io/ipfs/' + lnk.slice(7)
	}
	
	const params = { 'theUrl': lnk };
	const metadata = await Moralis.Cloud.run("fetchJSON", params);

	<!-- const str = JSON.stringify(metadata.data.image); -->
	<!-- const bytes = new TextEncoder().encode(str); -->
	<!-- const blob = new Blob([bytes], { -->
		<!-- type: "application/json;charset=utf-8" -->
	<!-- }); -->
	
	
	var image_ = metadata.data.image
	if (image_.substring(0,4) == "ipfs"){
	image_ = 'https://ipfs.io/ipfs/' + image_.slice(7)
	}
	console.log("metadata_image" + image_)
  //var urlCreator = window.URL || window.webkitURL;
   //var imageUrl = urlCreator.createObjectURL(image_);
   //const myImgElem = document.getElementById('my-img');
   //var myImgElem = new Image;
   
   //myImgElem.src = imageUrl;
   var img = new Image();
	//img.crossOrigin="anonymous"
	img.src = image_ //imageUrl
	//ew1Div.addEventListener("load", getCanvas);
	img.onload = function (){
	
		//var canvas = document.getElementById("myCanvas");
		var canvas = document.createElement('canvas');
		canvas.id = "b" + n;
        var ctx = canvas.getContext('2d');
		var width = img.width;
		var height = img.height;

 if (width > height) {
    if (width > 75 ){
      //height *= max_width / width;
      height = Math.round(height *= 75 / width);
      width = 75;
    }
  } else {
    if (height > 75) {
      //width *= max_height / height;
      width = Math.round(width *= 75 / height);
      height = 75;
    }
  }
  
  // resize the canvas and draw the image data into it
  canvas.width = width;
  canvas.height = height;
  var ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0, width, height);

        ctx.drawImage(img, 0, 0, width, height);
		bx.insertBefore(canvas, bx.children[0]);
		//container.id = "cc" & i;
		return canvas.toDataURL("image/*",0.2);
		
			
			}
	
		
   //ew1Div.appendChild(canvas1);
  

})()		
	
}
	
  
	//document.getElementById("thetable").appendChild(toAdd);



})()

        });





function isError(obj){
    return Object.prototype.toString.call(obj) === "[object Error]";
}

	





function make_trade(add1x, add2x, tokenID, n){

	var nft = add1x
	var address = add2x
	var nft_id = tokenID
	var num = n
	
	//to_approve(nft, nft_id)
var acct = (async function(){
  	
  //var result = await getAccounts()
	await window.ethereum.enable();
	
	
	
	
	
        var _data = new web3.eth.Contract(abi, contract_address).methods.accept_trade(num, address).encodeABI();
        var accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        var account = accounts[0];
	var result = await web3.eth.getTransactionCount(account)
	_nonce = result
        console.log(account)
		
	await web3.eth.sendTransaction({'gas': web3.utils.toHex(500000),'gasPrice': web3.utils.toHex(web3.utils.toWei('100', 'gwei')), 'from': account, 'to': contract_address, 'nonce': web3.utils.toHex(_nonce),'data': _data})
         

})()
}

	
	
	
function transfer_to_lender(addx, id){
var acct = (async function(){
  	
  //var result = await getAccounts()
	await window.ethereum.enable();
	
	
	//var add1x = localStorage.getItem("mySharedData");
	var add1x = addx
	
	
	var nft_k = localStorage.getItem("NFT Contract");
	//var nft_id = localStorage.getItem("NFT Token ID");
	//var nft_id = id
	var tokenID = await contract_bal.methods.tokens_list1(address).call();
	console.log(tokenID)
	var loan_amt = localStorage.getItem("Loan Amount");
	var loan_term = localStorage.getItem("Loan Term");
	
 	//var contract = web3.utils.toChecksumAddress(nft_k)
        var _data = new web3.eth.Contract(abi, contract_address).methods.TransferToLender(add1x, nft_id).encodeABI();
        var accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        var account = accounts[0];
		var amt = await contract_bal.methods.loan_amount_list(add1x).call();
	
	var result = await web3.eth.getTransactionCount(account)
	_nonce = result
        console.log(account)
		
	await web3.eth.sendTransaction({'gas': web3.utils.toHex(200000),'gasPrice': web3.utils.toHex(web3.utils.toWei('100', 'gwei')), 'from': account, 'to': contract_address, 'nonce': web3.utils.toHex(_nonce),'data': _data})
         //window.ethereum.on('accountsChanged', function (accounts) {
            // Time to reload your interface with accounts[0]!
            //console.log(accounts[0])
           	
  //console.log('Woo done!', result[0])
  //balance = result
  //alert(balance)

})()
}





function image_and_name(k,n, getImage){

	//localStorage.setItem("NFT Contract", document.getElementById("NFT_contract").value);
	//localStorage.setItem("NFT Token ID", document.getElementById("NFT_Token_ID").value);
	
	//var nft_k = localStorage.getItem("NFT Contract");
	var nft_k = k 
	//var nft_id = localStorage.getItem("NFT Token ID");
	var nft_id = n
  var val = (async function(){
  const contract_address = web3.utils.toChecksumAddress(nft_k)
  const wallet_address = "0xBC7f9EbC7dBCc236873f37005cfD959523faB727"
  const contract_bal = await new web3.eth.Contract(abi, contract_address);
  const lnk = await contract_bal.methods.tokenURI(nft_id).call();
  //alert(bal);
  //var result = await getvalue()
  //console.log('Woo done!', json)
	var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            getImage(this)
			//var result = this.response;
			//JSONresult = JSON.parse(result);
			//console.log(JSONresult.image);
			//var result1 = JSONresult.image
			//return result1
       }
    };
    xhttp.open("GET", lnk, false);
    xhttp.send();
	

})()
//return val
	}

function reclaim_asset(){
var acct = (async function(){
  	
  //var result = await getAccounts()
	await window.ethereum.enable();
	localStorage.setItem("mySharedData", document.getElementById("password").value);
	localStorage.setItem("mySharedData1", document.getElementById("user_name").value);
	localStorage.setItem("mySharedData2", document.getElementById("user_name1").value);
	
	var add1x = localStorage.getItem("mySharedData");
	var add2x = localStorage.getItem("mySharedData2");
	var token_nx = localStorage.getItem("mySharedData1");
	
	localStorage.setItem("NFT Contract", document.getElementById("NFT_contract").value);
	localStorage.setItem("NFT Token ID", document.getElementById("NFT_Token_ID").value);
	localStorage.setItem("Loan Amount", document.getElementById("loan_amount").value);
	localStorage.setItem("Loan Term", document.getElementById("loan_term").value);
	
	var nft_k = localStorage.getItem("NFT Contract");
	var nft_id = localStorage.getItem("NFT Token ID");
	var loan_amt = localStorage.getItem("Loan Amount");
	var loan_term = localStorage.getItem("Loan Term");
	
 	var contract = web3.utils.toChecksumAddress(nft_k)
        var _data = new web3.eth.Contract(abi, contract_address).methods.ReturnToBorrower().encodeABI();
        var accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        var account = accounts[0];
		var amt = await contract_bal.methods.loan_amount_list(add1x).call();
	var _amt = parseInt(amt) + (amt/50) + 1
	console.log(amt);
	console.log(_amt);
	var result = await web3.eth.getTransactionCount(account)
	_nonce = result
        console.log(account)
		
	await web3.eth.sendTransaction({'gas': web3.utils.toHex(200000),'gasPrice': web3.utils.toHex(web3.utils.toWei('100', 'gwei')), 'from': account, 'to': contract_address, 'value': _amt, 'nonce': web3.utils.toHex(_nonce),'data': _data})
         //window.ethereum.on('accountsChanged', function (accounts) {
            // Time to reload your interface with accounts[0]!
            //console.log(accounts[0])
           	
  //console.log('Woo done!', result[0])
  //balance = result
  //alert(balance)

})()
}





//client_account = accounts[0]; // assuming master client addr



function to_approve(k, add, k_id, num){
var acct = (async function(){
  	
  //var result = await getAccounts()
	await window.ethereum.enable();
	
	for (var i = 0; i<k.length; i++){
	var nft_k = k[i]
	//var nft_id = localStorage.getItem("NFT Token ID");
	var add1 = add
	var nft_id = k_id[i]
	var n = num
	var loan_amt = localStorage.getItem("Loan Amount");
	var loan_term = localStorage.getItem("Loan Term");
	
	var add1x = localStorage.getItem("mySharedData");
	var add2x = localStorage.getItem("mySharedData2");
	var token_nx = localStorage.getItem("mySharedData1");
	
 	var contract_address1 = web3.utils.toChecksumAddress(nft_k)
        var _data = new web3.eth.Contract(abi, contract_address).methods.approve("0xd4ba547282a909afc9b4c58c9f4777a34a8582eb", nft_id).encodeABI();
        var accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        var account = accounts[0];
	var result = await web3.eth.getTransactionCount(account)
	_nonce = result
        console.log(account)
		
	await web3.eth.sendTransaction({'gas': web3.utils.toHex(100000),'gasPrice': web3.utils.toHex(web3.utils.toWei('100', 'gwei')), 'from': account, 'to': contract_address1, 'nonce': web3.utils.toHex(_nonce),'data': _data})
         //window.ethereum.on('accountsChanged', function (accounts) {
            // Time to reload your interface with accounts[0]!
            //console.log(accounts[0])
           	
  //console.log('Woo done!', result[0])
  //balance = result
  //alert(balance)
  }
	make_trade(nft_k, add1, nft_id, n)
})()

}

function getNFT(){
var my_nft =(async function(){
var contract_address = await web3.utils.toChecksumAddress("0xd4ba547282a909afc9b4c58c9f4777a34a8582eb")

var contract_bal = await new web3.eth.Contract(abi, contract_address);
var totalSupply = await contract_bal.methods.baseURI().call();
alert(totalSupply)
})()
//return val
	}





function getName(k){
//q = $('input[name=drone]:checked').val();	
	//alert(bal)
	
var val = (async function(){
  var contract_address = await web3.utils.toChecksumAddress(k)
  var contract_bal = await new web3.eth.Contract(abi, contract_address);
  var bal = await contract_bal.methods.name.call();
  //alert(bal);
  var result = await getName()
  console.log('Woo done!', bal)
 
	

})()
//return val
	}
















          
    </script>
	
</body>
</html>